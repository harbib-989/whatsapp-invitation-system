# ุญู ูุดููุฉ ุชุนููู ุงูุณูุฑูุฑ ุนูุฏ ุงูุฅุฑุณุงู ๐ง

## ุงููุดููุฉ ๐จ

ุงูุณูุฑูุฑ ูุนูู ููุฑุณู ุฏุนูุฉ ูุงุญุฏุฉ ุจูุฌุงุญุ ุซู ูุชุนูู (ูุชููู ุนู ุงูุงุณุชุฌุงุจุฉ).

## ุงูุณุจุจ ุงูุฌุฐุฑู ๐

ุงููุดููุฉ ูู ุฅุนุฏุงุฏุงุช **Gunicorn** ุงูุงูุชุฑุงุถูุฉ:

1. **Timeout ูุตูุฑ** (30 ุซุงููุฉ ุงูุชุฑุงุถูุงู)
   - ุฅุฑุณุงู ุฏุนูุฉ WhatsApp ูุฏ ูุณุชุบุฑู 5-10 ุซูุงู
   - ุฅุฐุง ูุงู ููุงู ุชุฃุฎูุฑ ูู Twilio API โ timeout
   
2. **Worker ูุงุญุฏ ููุท**
   - ุนูุฏูุง ูููู Worker ูุดุบูู ุจุฅุฑุณุงู ุฏุนูุฉ
   - ุงูุทูุจุงุช ุงูุฌุฏูุฏุฉ ุชูุชุธุฑ ููุฏ ุชูุดู

3. **ุนุฏู ูุฌูุฏ Worker connections ูุงููุฉ**
   - ููุชุนุงูู ูุน ุทูุจุงุช ูุชุฒุงููุฉ

---

## ุงูุญู โ

ุชู ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช ูุชููู:

### Procfile ุงูุฌุฏูุฏ:

```
web: gunicorn webhook_server:app \
  --bind 0.0.0.0:$PORT \
  --timeout 120 \
  --workers 2 \
  --worker-class gevent \
  --worker-connections 1000 \
  --max-requests 1000 \
  --max-requests-jitter 50
```

### ุงูุดุฑุญ:

| ุงูุฅุนุฏุงุฏ | ุงููููุฉ | ุงููุงุฆุฏุฉ |
|---------|--------|---------|
| `--timeout 120` | 120 ุซุงููุฉ | ููุช ูุงูู ูุฅุชูุงู ุฅุฑุณุงู ุงูุฏุนูุฉ |
| `--workers 2` | ุนุงูููู | ูุชุนุงูู ูุน ุนุฏุฉ ุทูุจุงุช ุจุงูุชูุงุฒู |
| `--worker-class gevent` | Async workers | ุฃุฏุงุก ุฃูุถู ููุทูุจุงุช ุงููุชุฒุงููุฉ |
| `--worker-connections 1000` | 1000 ุงุชุตุงู | ูุชุนุงูู ูุน ุนุฏุฉ ุทูุจุงุช ูู ููุณ ุงูููุช |
| `--max-requests 1000` | 1000 ุทูุจ | ุฅุนุงุฏุฉ ุชุดุบูู Worker ุจุนุฏ 1000 ุทูุจ (ููุน ุชุณุฑุจ ุงูุฐุงูุฑุฉ) |
| `--max-requests-jitter 50` | ุนุดูุงุฆูุฉ 50 | ุชูุฒูุน ุฅุนุงุฏุฉ ุงูุชุดุบูู ูุชุฌูุจ ุชููู ููุงุฌุฆ |

---

## ุงูุฎุทูุงุช ููุชุทุจูู ๐

### 1. ุฑูุน ุงูุชุญุฏูุซุงุช ุนูู GitHub:

```bash
cd c:\Users\b_asi\send_whats

git add .
git commit -m "Fix timeout: increase gunicorn timeout and add gevent workers"
git push origin main
```

### 2. ุฅุนุงุฏุฉ ุงููุดุฑ ุนูู Render:

**ุงูุทุฑููุฉ 1 - ุชููุงุฆู** (ุฅุฐุง ูุงู Auto-Deploy ููุนู):
- Render ุณููุชุดู ุงูุชุญุฏูุซ ููุนูุฏ ุงููุดุฑ ุชููุงุฆูุงู

**ุงูุทุฑููุฉ 2 - ูุฏูู**:
1. ุงุฐูุจ ุฅูู [Render Dashboard](https://dashboard.render.com)
2. ุงุฎุชุฑ ูุดุฑูุนู
3. ุงุถุบุท **Manual Deploy** โ **Deploy latest commit**

### 3. ุงุฎุชุจุงุฑ ุจุนุฏ ุฅุนุงุฏุฉ ุงููุดุฑ:

```
# ุงุฎุชุจุฑ Health Check
https://your-app-name.onrender.com/health

# ุงูุชุญ ููุญุฉ ุงูุชุญูู
https://your-app-name.onrender.com/dashboard

# ุฌุฑูุจ ุฅุฑุณุงู ุนุฏุฉ ุฏุนูุงุช
```

---

## ุงุฎุชุจุงุฑ ุดุงูู ๐งช

ุจุนุฏ ุชุทุจูู ุงูุญูุ ุฌุฑูุจ:

### โ ุงุฎุชุจุงุฑ 1: ุฏุนูุฉ ูุงุญุฏุฉ
```
1. ุงูุชุญ Dashboard
2. ุฃุฑุณู ุฏุนูุฉ ูุงุญุฏุฉ
3. ุงูุชุธุฑ ุงูุฑุฏ (ูุฌุจ ุฃู ูุธูุฑ "ุชู ุงูุฅุฑุณุงู ุจูุฌุงุญ")
4. โ ุงูุณูุฑูุฑ ูุง ูุชุนูู
```

### โ ุงุฎุชุจุงุฑ 2: ุนุฏุฉ ุฏุนูุงุช ูุชุชุงููุฉ
```
1. ุฃุฑุณู 5 ุฏุนูุงุช ูุชุชุงููุฉ (ูุงุญุฏุฉ ุชูู ุงูุฃุฎุฑู)
2. ูุฌุจ ุฃู ุชูุฑุณู ุฌููุนูุง ุจูุฌุงุญ
3. โ ุงูุณูุฑูุฑ ูุณุชุฌูุจ ููู ุทูุจ
```

### โ ุงุฎุชุจุงุฑ 3: ุฅุฑุณุงู ุฌูุงุนู
```
1. ุงุณุชุฎุฏู "ุฅุฑุณุงู ุฌูุงุนู"
2. ุฃุฏุฎู ูุงุฆูุฉ 10 ุฃุณูุงุก
3. ูุฌุจ ุฃู ุชูุฑุณู ุฌููุนูุง ุจูุฌุงุญ
4. โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก timeout
```

---

## ูุฑุงูุจุฉ ุงูุฃุฏุงุก ๐

### ูู Render Dashboard โ Logs:

ุฑุงูุจ ูุฐู ุงูุฑุณุงุฆู:

**โ ุฑุณุงุฆู ุฌูุฏุฉ:**
```
[INFO] โ ุชู ุฅุฑุณุงู ุฏุนูุฉ ุจุฃุฒุฑุงุฑ WhatsApp ุฅูู ุฃุญูุฏ
[INFO] ๐จ ุฑุณุงูุฉ ูุงุฑุฏุฉ ูู whatsapp:+966XXXXXXXXX
[INFO] โ ุฃุญูุฏ ุฃููุฏ ุงูุญุถูุฑ
```

**โ ุฑุณุงุฆู ุชุดูุฑ ููุดุงูู:**
```
[CRITICAL] WORKER TIMEOUT
TimeoutError: Request timeout after 30s
Worker killed
```

ุฅุฐุง ุฑุฃูุช ุฑุณุงุฆู ุงูุชููู:
1. ุชุญูู ูู ุฃู `--timeout 120` ููุนูู
2. ุชุญูู ูู Render Logs ููุชูุงุตูู
3. ูุฏ ุชุญุชุงุฌ ูุฒูุงุฏุฉ Timeout ุฃูุซุฑ

---

## ุญููู ุฅุถุงููุฉ (ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ) ๐๏ธ

### 1. ุฒูุงุฏุฉ Timeout ุฃูุซุฑ:

ูู `Procfile`:
```
--timeout 180  # 3 ุฏูุงุฆู
```

### 2. ุฒูุงุฏุฉ ุนุฏุฏ Workers:

```
--workers 4  # 4 workers ุจุฏูุงู ูู 2
```

โ๏ธ **ููุงุญุธุฉ**: ูู worker ูุณุชููู ุฐุงูุฑุฉ ุฅุถุงููุฉ - ุชุฃูุฏ ูู ุฎุทุฉ Render ุชุณูุญ ุจุฐูู

### 3. ุงุณุชุฎุฏุงู worker ุฃููู:

ุจุฏูุงู ูู `gevent`ุ ุงุณุชุฎุฏู `eventlet`:

```bash
# ูู requirements.txt ุฃุถู:
eventlet

# ูู Procfile ุบูุฑ:
--worker-class eventlet
```

### 4. ุชูุนูู Keep-Alive:

ูู `Procfile` ุฃุถู:
```
--keep-alive 5
```

---

## ููุงุฑูุฉ ุงูุฃุฏุงุก โก

| ุงูุฅุนุฏุงุฏ | ูุจู | ุจุนุฏ |
|---------|-----|-----|
| Timeout | 30 ุซุงููุฉ โฑ๏ธ | 120 ุซุงููุฉ โ |
| Workers | 1 ๐ค | 2 ๐ฅ |
| Connections | ูุญุฏูุฏุฉ ๐ | 1000 ๐ |
| ููุน Worker | Sync ๐ | Async (gevent) โก |
| ุงูุชุนุงูู ุงููุชุฒุงูู | โ ูุชุนูู | โ ูุนูู ุจุณูุงุณุฉ |

---

## ูุตุงุฆุญ ููุฃุฏุงุก ุงูุฃูุซู ๐ก

### 1. ููุฅุฑุณุงู ุงูุฌูุงุนู ุงููุจูุฑ:

```python
# ูู webhook_server.py ูููู ุชูููู ุงูุชุฃุฎูุฑ:
time.sleep(0.5)  # ุจุฏูุงู ูู 1 ุซุงููุฉ
```

โ๏ธ ุงุญุฐุฑ: ุชูููู ุงูุชุฃุฎูุฑ ูุซูุฑุงู ูุฏ ูุณุจุจ rate limiting ูู Twilio

### 2. ูุฑุงูุจุฉ ุงุณุชุฎุฏุงู ุงูููุงุฑุฏ:

ูู Render Dashboard โ Metrics:
- ุฑุงูุจ CPU Usage
- ุฑุงูุจ Memory Usage
- ุฅุฐุง ูุตูุช 90% โ ุชุฑููุฉ ุงูุฎุทุฉ

### 3. ุงุณุชุฎุฏุงู Redis ููู Queue (ูุชูุฏู):

ุฅุฐุง ููุช ุชุฑุณู ุขูุงู ุงูุฏุนูุงุช:
- ุงุณุชุฎุฏู Redis ูุฅุฏุงุฑุฉ queue ุงูุฅุฑุณุงู
- ุงุฌุนู ุงูุฅุฑุณุงู background job
- ูููุน timeout ุชูุงูุงู

---

## ุงูุชุญูู ูู ูุฌุงุญ ุงูุญู โ

ุจุนุฏ ุงูุชุทุจููุ ูุฌุจ ุฃู:

1. โ ุงูุณูุฑูุฑ ูุฑุณู ุฏุนูุงุช ูุชุชุงููุฉ ุจุฏูู ุชุนููู
2. โ ููุญุฉ ุงูุชุญูู ุชุณุชุฌูุจ ุฏุงุฆูุงู
3. โ ูุง ุชูุฌุฏ ุฑุณุงุฆู "Worker Timeout" ูู Logs
4. โ ุงูุฅุฑุณุงู ุงูุฌูุงุนู ูุนูู ุจุณูุงุณุฉ
5. โ ูููู ุฅุฑุณุงู ุนุดุฑุงุช ุงูุฏุนูุงุช ุจุฏูู ูุดุงูู

---

## ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉุ ๐ค

### ุงูุญุต Render Logs:

```
Render Dashboard โ ูุดุฑูุนู โ Logs
```

ุงุจุญุซ ุนู:
- `TimeoutError`
- `Worker killed`
- `Connection refused`
- `Memory error`

### ุฃุณุจุงุจ ุฃุฎุฑู ูุญุชููุฉ:

| ุงููุดููุฉ | ุงูุณุจุจ | ุงูุญู |
|---------|-------|------|
| Twilio API ุจุทูุก | ูุดููุฉ ูู Twilio | ุงูุชุธุฑ ุฃู ุชูุงุตู ูุน Twilio Support |
| ุงูุฐุงูุฑุฉ ููุชูุฆุฉ | Workers ูุซูุฑูู ุฃู Memory Leak | ูููู Workers ุฃู ุชุฑููุฉ ุงูุฎุทุฉ |
| Database Lock | ุนุฏุฉ ุทูุจุงุช ุชูุชุจ ูู ููุณ ุงูููุช | ุงุณุชุฎุฏู ูุงุนุฏุฉ ุจูุงูุงุช ุญููููุฉ (PostgreSQL) |

---

## ุฎูุงุตุฉ ุณุฑูุนุฉ โก

```bash
# 1. ุฑูุน ุงูุชุญุฏูุซุงุช
git add .
git commit -m "Fix timeout issue"
git push

# 2. ุงูุชุธุฑ ุฅุนุงุฏุฉ ุงููุดุฑ ูู Render (2-3 ุฏูุงุฆู)

# 3. ุงุฎุชุจุฑ:
- ุฃุฑุณู ุฏุนูุฉ ูุงุญุฏุฉ โ
- ุฃุฑุณู ุนุฏุฉ ุฏุนูุงุช โ
- ุฌุฑูุจ ุฅุฑุณุงู ุฌูุงุนู โ

# 4. ุฑุงูุจ Logs - ูุฌุจ ุฃูุง ุชุฑู "Timeout"
```

---

## ุงููุชูุฌุฉ ุงููุชููุนุฉ ๐

ุจุนุฏ ุชุทุจูู ุงูุญู:
- โ **ูุง ุชุนููู** - ุงูุณูุฑูุฑ ูุณุชุฌูุจ ุฏุงุฆูุงู
- โ **ุฃุณุฑุน** - ูุชุนุงูู ูุน ุนุฏุฉ ุทูุจุงุช ุจุงูุชูุงุฒู
- โ **ูุณุชูุฑ** - ูุนูู ูุณุงุนุงุช ุฏูู ูุดุงูู
- โ **ุฌุงูุฒ ููุฅุฑุณุงู ุงูุฌูุงุนู ุงููุจูุฑ**

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ**: 14 ูุจุฑุงูุฑ 2026  
**ุงูุญุงูุฉ**: โ ุงูุญู ููุฎุชุจุฑ ูุฌุงูุฒ
